# Chapter 7 DRAWING IN DIRECT3D PART II

这一章节我们将会介绍一些会在本书剩余部分使用的渲染模式。
章节最开始，我们将会介绍一个关于渲染优化的东西，一个叫做`帧资源(Frame Resources)`的东西。具体来说就是我们通过一些方法来避免在每一帧中刷新指令队列，及尽量减少同步`CPU`和`GPU`使得我们能够充分使用他们。之后我们介绍一下关于分项渲染的概念。之后，我们会了解更多关于来源标记的细节，以及学习另外两个参数类型，描述符(`root descriptors`)和常量(`root constants`)。最后，我们将会绘制一些复杂的物体。

> 目标：
- 了解如何修改我们的渲染过程来避免每一帧都刷新指令队列，从而提升我们的程序效率。
- 了解另外两个来源标记的参数类型，描述符和常量。
- 了解如何生成和渲染一些基础的物体，例如网格，球体等。
- 了解如何使用`CPU`去改变顶点数据，然后使用`GPU`更新到我们的缓冲中去。

## 7.1 FRAME RESOURCES

回顾4.2，我们知道`GPU`和`CPU`的运行是互相独立的，即平行的，`CPU`构建和提交指令列表，`GPU`处理指令队列里面的指令。而我们的目的就是保持`CPU`和`GPU`不断的运行，从而能够充分使用硬件资源。在之前我们的例子中，我们会在每一帧结束的时候同步`GPU`和`CPU`，下面有两个这样做的理由。

- 在`GPU`没有执行完所有的指令队列的时候指令分配器是不能够重置的。假设我们不同步他们的话，那么`CPU`可能就在`GPU`还没有处理完第$n$帧的指令的时候就开始处理第$n+1$帧的内容，那么如果在第$n+1$帧的时候，`CPU`重置指令分配器的话，`GPU`还在处理第$n$帧的指令，那么`GPU`还没有处理的指令就会被清空。
- 如果一个常缓冲会在一个渲染指令中使用的话，那么在`GPU`执行完这个指令前是不能够使用`CPU`更新它的。在4.22中我们提到过，假设我们不同步的话，`CPU`可能在第$n+1$帧的时候更新我们的常缓冲，但是`GPU`却还没有执行第$n$帧中使用了这个常缓冲的渲染指令的话，那么当`GPU`执行到这个指令的时候，常缓冲里面的数据就已经不是第$n$帧的数据而是第$n+1$帧的数据了。

因此我们非常有必要在每帧的结束的时候同步我们的`CPU`和`GPU`，但是这样做的话，会浪费我们的效率。

- 在这一帧循环刚开始的时候可能`GPU`可能没有任何任务需要处理，要等到`CPU`提交指令列表后才可以处理。
- 在这一帧循环结束的时候，我们的`CPU`要等待我们的`GPU`执行完这一帧的所有的指令。

简单来说这样做的话在每一帧都会有一段时间`CPU`或者`GPU`处于空闲阶段。